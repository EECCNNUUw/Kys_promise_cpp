# GRP文件分析报告

## 1. 文件结构

### Ranger.grp文件
- 文件大小: 213530 bytes
- 索引文件: ranger.idx (24 bytes, 包含6个偏移量)

### R1.grp文件
- 文件大小: 213530 bytes
- 使用ranger.idx作为索引文件

## 2. 数据类型偏移量

根据ranger.idx文件，Ranger.grp文件包含6种数据类型：

| 类型 | 偏移量 (十六进制) | 偏移量 (十进制) | 数据块大小 |
|------|------------------|------------------|-----------|
| 基本数据 | 0x0000066a | 1642 | 94640 bytes |
| 人物数据 | 0x0001781a | 96282 | 62890 bytes |
| 物品数据 | 0x00026dc4 | 159172 | 5564 bytes |
| 场景数据 | 0x00028380 | 164736 | 48396 bytes |
| 武功数据 | 0x0003408c | 213132 | 396 bytes |
| 小宝商店 | 0x00034218 | 213528 | 2 bytes |

## 3. 基本数据解析

使用0x99作为XOR密钥解码后，基本数据部分（偏移0-1642）的解析结果：

- 乘船: 119（不合理，应该是0或1）
- 人X: 494（合理，范围0-479）
- 人Y: 174（合理，范围0-479）
- 人X1坐标: 106（合理）
- 人Y1坐标: 91（合理）
- 人面对方向: 116（不合理，应该是0-3）
- 船X: 483（合理）
- 船Y: 148（合理）
- 船X1: 65416（不合理）
- 船Y1: 65416（不合理）
- 船面对方向: 119（不合理，应该是0-3）

**结论**: 使用0x99作为XOR密钥解码后，基本数据部分的部分数值合理，但仍有部分数值不合理。

## 4. 人物记录解析

### UPedit.ini中的人物记录结构

人物记录包含83个字段，总大小为396字节：

- 代号: 偏移0, 2字节
- 头像/战斗代号: 偏移2, 2字节
- 生命增长: 偏移4, 2字节
- 无用: 偏移6, 2字节
- 姓名: 偏移8, 10字节
- 外号: 偏移18, 10字节
- 性别: 偏移28, 2字节
- 等级: 偏移30, 2字节
- 经验值: 偏移32, 2字节
- 生命: 偏移34, 2字节
- 生命最大值: 偏移36, 2字节
- 受伤程度: 偏移38, 2字节
- 中毒程度: 偏移40, 2字节
- 体力: 偏移42, 2字节
- ...（其他字段）

### 人物数据部分分析

人物数据部分（偏移96282-159172，大小62890字节）使用0x99作为XOR密钥解码后：

- 字节频率分析显示最常见的字节是0x99 (29.00%)和0xee (25.56%)
- 解码后数据包含大量重复的模式：0x77 0x00和0x88 0xff
- 尝试按照396字节的记录大小解析，没有找到合理的人物记录

### 尝试的解码方法

1. 使用0x99作为XOR密钥解码
2. 使用0x36作为XOR密钥解码
3. 不使用XOR解码，直接解析
4. 尝试不同的记录大小（396, 400, 440, 4400, 1000, 2000, 500, 600, 700, 800, 900字节）

**结论**: 所有尝试都没有找到合理的人物记录（等级1-30，生命1-999，性别0-2）。

## 5. 可能的原因

1. **数据压缩**: 人物数据部分可能使用了某种压缩算法
2. **数据加密**: 可能使用了更复杂的加密算法，而不是简单的XOR
3. **记录大小不正确**: 人物记录的实际大小可能不是396字节
4. **数据结构不同**: 人物记录的实际结构可能与UPedit.ini中定义的不同
5. **数据偏移量不正确**: 人物数据的实际偏移量可能与ranger.idx中定义的不同

## 6. 下一步建议

1. 尝试分析人物数据部分的压缩模式
2. 尝试使用更复杂的加密算法（如AES、DES等）
3. 尝试查找人物数据部分的其他模式或边界标记
4. 尝试分析其他存档文件（如R2.grp, R3.grp等）的结构
5. 尝试查找UPedit程序的源代码或文档，了解数据编码方式
